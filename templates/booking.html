{% extends 'base.html' %}

{% load static %}

{% block title %} Welcome | {% endblock %}

{% block head_extras %}

    <link rel='stylesheet' href='https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css'>

    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

    <script src='//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
    <script src='//ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js'></script>

    <link href="{% static 'fontawesomefree/css/fontawesome.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'fontawesomefree/css/all.min.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'fontawesomefree/css/solid.css' %}" rel="stylesheet" type="text/css">

    <script>
        function DateDisable() {
            var dtToday = new Date();

            var month = dtToday.getMonth() + 1;
            var day = dtToday.getDate() + 1;
            var year = dtToday.getFullYear ();
            if(month < 10)
                month = '0' + month.toString();
            if(day < 10)
                day = '0' + day.toString();


            var maxDate = year + '-' + month + '-' + day;

            $('#dateControl').attr('min', maxDate);
        }
    </script>


    <script>
        $( function() {
            $("#slider-range").slider({
                range: true,
                min: 480,
                max: 1080,
                step: 30,
                values: [480, 1080],
                slide: function (e, ui) {
                    var hours1 = Math.floor(ui.values[0] / 60);
                    var minutes1 = ui.values[0] - (hours1 * 60);
    
                    // if (hours1.length == 1) hours1 = '0' + hours1;
                    if (minutes1.length == 1) minutes1 = '0' + minutes1;
                    if (minutes1 == 0) minutes1 = '00';
                    if (hours1 < 10)
                        hours1 = '0' + hours1.toString();
                    

                    // if (hours1 >= 12) {
                    //     if (hours1 == 12) {
                    //         hours1 = hours1;
                    //         minutes1 = minutes1 + " PM";
                    //     } else {
                    //         hours1 = hours1 - 12;
                    //         minutes1 = minutes1 + " PM";
                    //     }
                    // } else {
                    //     hours1 = hours1;
                    //     minutes1 = minutes1 + " AM";
                    // }
                    // if (hours1 == 0) {
                    //     hours1 = 12;
                    //     minutes1 = minutes1;
                    // }
    
                    var Time_From = document.getElementById("Time_From")
    
                    Time_From.value = hours1 + ':' + minutes1;

                    // console.log(Time_From.value)

    
                    var hours2 = Math.floor(ui.values[1] / 60);
                    var minutes2 = ui.values[1] - (hours2 * 60);
    
                    if (hours2.length == 1) hours2 = '0' + hours2;
                    if (minutes2.length == 1) minutes2 = '0' + minutes2;
                    if (minutes2 == 0) minutes2 = '00';

                    if (hours2 < 10)
                        hours2 = '0' + hours2.toString();
                    // if (hours2 >= 12) {
                    //     if (hours2 == 12) {
                    //         hours2 = hours2;
                    //         minutes2 = minutes2 + " PM";
                    //     } else if (hours2 == 24) {
                    //         hours2 = 11;
                    //         minutes2 = "59 PM";
                    //     } else {
                    //         hours2 = hours2 - 12;
                    //         minutes2 = minutes2 + " PM";
                    //     }
                    // } else {
                    //     hours2 = hours2;
                    //     minutes2 = minutes2 + " AM";
                    // }
                    
                    var Time_To = document.getElementById("Time_To")

                    Time_To.value = hours2 + ':' + minutes2;

                    // console.log(Time_To.value)
                    // $('.Time_To').html(hours2 + ':' + minutes2);
                }
            })
        } );
    </script>


    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBsRtR6J_NowzIITNDGs0QzIn9M_mSVyDs&libraries=places"></script>

    <!-- <script type="text/javascript"
              src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBsRtR6J_NowzIITNDGs0QzIn9M_mSVyDs"></>
      <script src="https://unpkg.com/location-picker/dist/location-picker.min.js"></script> -->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link href="https://unpkg.com/bootstrap-table@1.21.1/dist/bootstrap-table.min.css">

    <link href="https://unpkg.com/bootstrap-table@1.21.1/dist/bootstrap-table.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css">
    
    <!-- <link href="extensions/filter-control/bootstrap-table-filter-control.css"> -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <!-- <script src="https://unpkg.com/bootstrap-table@1.21.0/dist/extensions/filter-control/bootstrap-table-filter-control.min.js"></script> -->
    <script src="https://unpkg.com/bootstrap-table@1.21.1/dist/bootstrap-table.min.js"></script>
    <!-- <script src="https://unpkg.com/bootstrap-table@1.21.0/dist/extensions/filter-control/bootstrap-table-filter-control.js"></script> -->




{% endblock %}





{% block content %}

<div class="pt-10 pb-5 lg:pt-20 lg:pb-10 text-center">
    <h1 class="text-3xl lg:text-5xl primaryColorText">Book a Ride</h1>
</div>

{% if messages %}
	{% for message in messages %}
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        {{message}}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
	{% endfor %}
{% endif %}


<div class="card p-3" style="border-radius: 1rem;">
    
    <form method="post">
        {% csrf_token %}

        <div class="row">
            <div class="col-6 ">
                <label  class="form-label">Name:</label>
                <div class="input-group mb-3">
                    <span class="input-group-text" ><i class="fa-solid fa-user"></i></span>
                    <input type="text" class="form-control" name="UserId" placeholder="Name" required>
                </div>
            </div>

            
            <div class="col-3">
                <label class="form-label">Option:</label>
                <select class="form-select" name="CB_For_ID" required>
                    <option value="">Choose an Option...</option>
                    {% for option in options %}
                        <option value="{{ option.CB_For_ID }}">{{option.CB_For}}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-3">
                <label  class="form-label">Booking Date:</label>
                <div class="input-group mb-3"  onclick="DateDisable()">
                    <span class="input-group-text" ><i class="fa-solid fa-calendar-days"></i></span>
                    <input type="date" class="form-control" name="dt" id="dateControl" aria-describedby="basic-addon3" required>
                </div>
            </div>

        </div>

        <br/>
        <hr/>
        <br/>

        <div class="row align-items-center justify-content-center" id="time-range">
            <div class="col-xl-2 col-lg-3 col-md-4 col-4">
                <label  class="form-label">From:</label>
                <div class="input-group mb-3">
                    <span class="input-group-text" ><i class="fa-solid fa-clock"></i></span>
                    <input type="time" class="form-control text-center" name="Time_From" id="Time_From" value="08:00" required>
                    <!-- <label class="form-control Time_From text-center" name="Time_From" id="Time_From">8:00 AM</label> -->
                </div>
            </div>

            <div class="col-xl-2 col-lg-3 col-md-4 col-4">
                <label  class="form-label">To:</label>
                <div class="input-group mb-3">
                    <span class="input-group-text" ><i class="fa-solid fa-clock"></i></span>
                    <input type="time" class="form-control text-center" name="Time_To" id="Time_To" value="18:00" required>
                    <!-- <label class="form-control Time_To text-center" name="Time_To" id="Time_To">6:00 PM</label> -->
                </div>
            </div>

            <div class="col-8 mt-3">
                <div class="sliders_step1 col-12">
                    <div id="slider-range"></div>
                </div>
            </div>
        </div>

        <div class="row align-items-center">
            <div class="col-6">
                <label  class="form-label">Enter Pickup:</label>
                <div class="input-group mb-3">
                    <span class="input-group-text" ><i class="fa-solid fa-location-dot"></i></span>
                    <input type="text" name="Source" id="Source" class="form-control primaryColorText" required/>
                </div>
            </div>

            <div class="col-6">
                <label  class="form-label">Enter Destination:</label>
                <div class="input-group mb-3">
                    <span class="input-group-text" ><i class="fa-solid fa-location-dot"></i></span>
                    <input type="text" name="Destination" id="Destination" class="form-control primaryColorText" required/>
                </div>
            </div>
        </div>

        <br/>
        <hr/>
        <br/>

        <div class="row">
            <div class="col-3">
                <label  class="form-label">No of Passengers:</label>
                <div class="input-group mb-3">
                    <span class="input-group-text" ><i class="fa-solid fa-people-group"></i></span>
                    <input type="number" name="No_Of_Passenger" id="No_Of_Passenger" class="form-control primaryColorText" placeholder="Passenger Count" required/>
                </div>
            </div>

            <div class="col-9">
                <label  class="form-label">Purpose:</label>
                <div class="input-group mb-3">
                    <span class="input-group-text" ><i class="fa-solid fa-comment"></i></span>
                    <textarea name="Purpose" id="Purpose" class="form-control primaryColorText" placeholder="Enter your Purpose of Booking" required></textarea>
                </div>
            </div>
        </div>

        
        <br/>

        <center>
            <button class="btn btn-outline-success btn-lg px-11 mt-12 py-3 submit-btn" type="submit" >Book</button>
                <!-- <i class="loading-icon fa fa-spinner fa-spin" hidden></i>
                <span class="btn-text">Book</span> -->
        </center>
        
        <br/>
        <hr/>
        <br/>

        <table
            id="table"
            data-toggle="table"
            data-height="450"
            data-pagination="true"
            data-page-size="3"
            data-sort-name="dt"
            data-sort-order="desc"
            >
            <!-- data-show-refresh="true" -->
            <!-- data-side-pagination="server" -->
            <!-- data-search="true"  -->
            <!-- data-url="http://127.0.0.1:8000/administration/bookings/" -->
            <!-- data-page-list="[5]" -->
            <!-- data-side-pagination="server"
            data-filter-control="true"
            data-cache="false"  -->
            <!-- data-searchable="true" -->
            <!-- data-show-toggle="true"  -->
            <!-- data-search="true"> -->
            <!-- data-query-params="queryParams" -->
        <thead>
            <!-- <th data-field="dt" data-sortable="true" data-filter-control="input">Date</th> -->
          <tr>
            <th data-field="dt">Date</th>
            <th data-field="UserId">Name</th>
            <th data-field="Source">Source</th>
            <th data-field="Destination">Destination</th>
            <th data-field="Time_From">From</th>
            <th data-field="Time_To">To</th>
          </tr>
        </thead>
      </table>
    
        <!-- <div id="map"></div>
        <br>
        <button id="confirmPosition">Confirm Position</button>
        <br>
        <p>On idle position: <span id="onIdlePositionView"></span></p>
        <p>On click position: <span id="onClickPositionView"></span></p> -->

        <!-- <div class="col-6 align-items-center justify-content-center"> -->
            

            <!-- <div class="col-5">
                <button type="button" class="btn btn-info text-dark col-3" data-bs-toggle="modal" data-bs-target="#exampleModal">
                    Choose Location
                </button>
            </div>
            
            <div class="modal fade text-black" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
                    <div class="modal-content">
                        <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="text" id="autocomplete" class="primaryColorText"/>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                    </div>
                </div>
            </div> -->


    </form>

</div>


<!-- <div class="form-group row">
    <input type="hidden" id="latitude" name="latitude"/>
    <input type="hidden" id="longitude" name="longitude"/>

    <div class="col-sm-1"></div>

    <label class="form-control label col-sm-4">Location</label>

    <div class="col-sm-1">
        <a class="btn btn-info" onclick="initModal()">Choose Location</a>
    </div>
</div> -->


<!-- <div id="google_map" style="width:800px;height:400px;"></div>

</div> -->


{% endblock %}


{% block scripts %}
    <!-- <script>
        $(function() {
            $('#table').bootstrapTable()
        })
    </script> -->

    <script>
        var source = document.getElementById('Source');
        var destination = document.getElementById('Destination');
        var sourceLocation = new google.maps.places.Autocomplete(source);
        var destinationLocation = new google.maps.places.Autocomplete(destination);

        sourceLocation.setComponentRestrictions({'country': ['ke']});
        destinationLocation.setComponentRestrictions({'country': ['ke']});

    </script>

    <!-- <script>

        $(document).ready(function () {
            $(".submit-btn").on("click", function () {
                console.log($('form')[0].checkValidity())
                //use on form
                if ($('form')[0].checkValidity()) {
                        $(".loading-icon").attr("hidden", false);
                        $(".submit-btn").attr("disabled", true);
                        $(".btn-text").text("Please Wait...");
           
                 }         })
        })

    </script> -->

    <script>
        
        var dateControl = document.getElementById("dateControl")
        var data = $("#dateControl").value;

        // var newArray = obj.Students.filter(function (el){
        //     return el.Age >=15 &&
        //             el.RollNumber <= 200 &&
        //             el.Marks >= 80 ;
        //     }
        // );
        
        // function queryParams(params) {
        //     params.search = "2022-11-26";
        //     return params
        // }
        dateControl.onchange = function() {
            console.log(dateControl.value)
            // $("#table").bootstrapTable('showLoading')
            var rurl = "http://127.0.0.1:8000/administration/bookings/"+ dateControl.value
            $("#table").bootstrapTable('refresh', {silent: true, url: rurl})
            // $("#table").bootstrapTable('hideLoading')

            // $("#table").bootstrapTable('refresh', {silent: true, url: "http://127.0.0.1:8000/administration/bookings/"})
        }

    </script>

    <!-- <script>
    // Get element references
    var confirmBtn = document.getElementById('confirmPosition');
    var onClickPositionView = document.getElementById('onClickPositionView');
    var onIdlePositionView = document.getElementById('onIdlePositionView');
  
    // Initialize locationPicker plugin
    var lp = new locationPicker('map', {
      setCurrentPosition: true, // You can omit this, defaults to true
    }, {
      zoom: 15 // You can set any google map options here, zoom defaults to 15
    });
  
    // Listen to button onclick event
    confirmBtn.onclick = function () {
      // Get current location and show it in HTML
      var location = lp.getMarkerPosition();
      onClickPositionView.innerHTML = 'The chosen location is ' + location.lat + ',' + location.lng;
    };
  
    // Listen to map idle event, listening to idle event more accurate than listening to ondrag event
    google.maps.event.addListener(lp.map, 'idle', function (event) {
      // Get current location and show it in HTML
      var location = lp.getMarkerPosition();
      onIdlePositionView.innerHTML = 'The chosen location is ' + location.lat + ',' + location.lng;
    });
  </script>-->


{% endblock %}

